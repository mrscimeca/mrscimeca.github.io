<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet"type="text/css" href="new-1.css"> 
	<script src="https://cdn.jsdelivr.net/pyodide/v0.18.1/full/pyodide.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
  </head>
  <body>
<div class="demoContainer">
        <div id="sketch-holder" style="">
              <!-- You sketch will go here! -->
        <canvas id="defaultCanvas0" class="p5Canvas" width="1280" height="800" style="width: 640px; height: 400px; cursor: none;"></canvas></div>

        <div style="">
          <pre><code class="hljs objectivec"><span class="hljs-meta"># Inspired by Mats Lund:</span>
<span class="hljs-meta"># https://github.com/CoderMats/breakout </span>
<span class="hljs-meta"># Completely rewritten</span>

WIDTH =  <span class="hljs-number">640</span>    <span class="hljs-meta"># canvas width</span>
HEIGHT = <span class="hljs-number">400</span>    <span class="hljs-meta"># canvas height</span>
P_WIDTH =  <span class="hljs-number">50</span>   <span class="hljs-meta"># paddle halfwidth</span>
P_HEIGHT = <span class="hljs-number">8</span>    <span class="hljs-meta"># paddle halfheight</span>
B_ROWS = <span class="hljs-number">5</span>      <span class="hljs-meta"># bricks, number of rows</span>
B_COLS = <span class="hljs-number">10</span>     <span class="hljs-meta"># bricks, number of columns</span>
B_MARGINS = <span class="hljs-number">15</span>  <span class="hljs-meta"># margins for bricks (bottom, side)</span>
BALL_DIAM = <span class="hljs-number">10</span>  <span class="hljs-meta"># diameter of ball</span>
FPS = <span class="hljs-number">30</span>        <span class="hljs-meta"># frames per second</span>

<span class="hljs-meta"># block width, height, total space</span>
b_width = (WIDTH - <span class="hljs-number">2</span> * B_MARGINS) <span class="hljs-comment">// B_COLS</span>
b_height = <span class="hljs-number">40</span>  
b_gap = <span class="hljs-number">15</span>      <span class="hljs-meta"># gap between blocks</span>

<span class="hljs-meta"># constants, helper variables</span>
bw2 = b_width <span class="hljs-comment">// 2 </span>
bh2 = b_height <span class="hljs-comment">// 2</span>
dw = (b_width - b_gap) <span class="hljs-comment">// 2</span>
dh = (b_height - b_gap) <span class="hljs-comment">// 2</span>
r = BALL_DIAM <span class="hljs-comment">// 2    # ball diameter</span>
y_paddle = HEIGHT - <span class="hljs-number">30</span>

cell_colors = {<span class="hljs-number">1</span>:<span class="hljs-string">"green"</span> , <span class="hljs-number">2</span>:<span class="hljs-string">"blue"</span> , <span class="hljs-number">3</span>:<span class="hljs-string">"red"</span> , <span class="hljs-number">4</span>:<span class="hljs-string">"yellow"</span>}

game = None

def setup():
    global game
    createCanvas(WIDTH, HEIGHT, P2D)
    rectMode(CENTER)
    frameRate(FPS)
    noCursor()
    game = Game()

def new_game():
    global game
    new_level = game.level + <span class="hljs-keyword">int</span>(game.blocks_gone)
    game = Game(level=new_level)
        
def draw():
    global game
    <span class="hljs-keyword">if</span> game.blocks_gone:
        new_game()    
    <span class="hljs-keyword">if</span> not game.game_over:
        game.paddle.x = min(WIDTH - P_WIDTH, max(mouseX, P_WIDTH))
    game.update()        

def keyPressed():
    <span class="hljs-keyword">if</span> key == <span class="hljs-string">" "</span>:
        new_game()

<span class="hljs-keyword">class</span> Ball(object):
    def __init__(<span class="hljs-keyword">self</span>,level=<span class="hljs-number">1</span>):
        <span class="hljs-meta"># ball velocity</span>
        <span class="hljs-keyword">self</span>.vel = PVector(<span class="hljs-number">3</span> + <span class="hljs-keyword">int</span>(<span class="hljs-number">1.5</span> * level),<span class="hljs-number">-3</span> - <span class="hljs-keyword">int</span>(<span class="hljs-number">1.5</span> * level))
        xp = WIDTH <span class="hljs-comment">// 2 + int(random(-P_WIDTH - 40,P_WIDTH + 40))</span>
        yp = y_paddle - P_HEIGHT <span class="hljs-comment">// 2 - r - 1      </span>
        <span class="hljs-keyword">self</span>.pos = PVector(xp,yp)                   <span class="hljs-meta"># ball position</span>

    def update(<span class="hljs-keyword">self</span>):    
        <span class="hljs-keyword">self</span>.pos = PVector.add(<span class="hljs-keyword">self</span>.pos,<span class="hljs-keyword">self</span>.vel)
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.pos.x &gt;= WIDTH or <span class="hljs-keyword">self</span>.pos.x &lt;= <span class="hljs-number">0</span>):  
            <span class="hljs-keyword">self</span>.vel.x = -<span class="hljs-keyword">self</span>.vel.x
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.pos.y &lt;= <span class="hljs-number">0</span>):
            <span class="hljs-keyword">self</span>.vel.y = -<span class="hljs-keyword">self</span>.vel.y

<span class="hljs-keyword">class</span> Game(object):
    def __init__(<span class="hljs-keyword">self</span>,level=<span class="hljs-number">1</span>):
        <span class="hljs-keyword">self</span>.paddle = PVector(WIDTH <span class="hljs-comment">// 2, HEIGHT - 30)</span>
        <span class="hljs-keyword">self</span>.level = level
        <span class="hljs-keyword">self</span>.ball = Ball()
        <span class="hljs-keyword">self</span>.score = <span class="hljs-number">0</span> 
        <span class="hljs-keyword">self</span>.blocks = [<span class="hljs-keyword">int</span>(random(<span class="hljs-number">1.5</span>,<span class="hljs-number">4.5</span>)) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span>  range(B_ROWS * B_COLS)]
        <span class="hljs-keyword">self</span>.game_over = False
        <span class="hljs-keyword">self</span>.blocks_gone = False
        <span class="hljs-meta"># x, y positions of block centers</span>
        <span class="hljs-keyword">self</span>.centers = [((i % B_COLS) * b_width + B_MARGINS + bw2,
                         b_height * (i <span class="hljs-comment">// B_COLS) + B_MARGINS + bh2) </span>
                         <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(B_ROWS * B_COLS)]

    def update_ball(<span class="hljs-keyword">self</span>):
        <span class="hljs-keyword">self</span>.ball.update()
        px, py = <span class="hljs-keyword">self</span>.paddle.x, <span class="hljs-keyword">self</span>.paddle.y
        <span class="hljs-keyword">if</span> ((px - P_WIDTH -r) &lt;= <span class="hljs-keyword">self</span>.ball.pos.x
             &lt;= (px + P_WIDTH + r) and 
            (py - P_HEIGHT - r &lt;= <span class="hljs-keyword">self</span>.ball.pos.y 
             &lt;= py - P_HEIGHT)):
            <span class="hljs-meta"># ball is hitting paddle rectangle, reverse y_speed</span>
            <span class="hljs-keyword">self</span>.ball.vel.y = -<span class="hljs-keyword">self</span>.ball.vel.y
            <span class="hljs-keyword">self</span>.score = <span class="hljs-keyword">self</span>.score + <span class="hljs-number">1</span>
        fill(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">200</span>)
        ellipse(<span class="hljs-keyword">self</span>.ball.pos.x, <span class="hljs-keyword">self</span>.ball.pos.y, BALL_DIAM, BALL_DIAM)

            
    def update_paddle(<span class="hljs-keyword">self</span>):
        fill(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)
        rect(<span class="hljs-keyword">self</span>.paddle.x, <span class="hljs-keyword">self</span>.paddle.y, <span class="hljs-number">2</span> * P_WIDTH, <span class="hljs-number">2</span>* P_HEIGHT)
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ball.pos.y &gt;= HEIGHT):
            fill(<span class="hljs-number">255</span>) 
            textSize(<span class="hljs-number">40</span>)
            textAlign(CENTER)
            text(<span class="hljs-string">"Game over"</span>, WIDTH <span class="hljs-comment">// 2, HEIGHT // 2 + 40)</span>
            <span class="hljs-keyword">self</span>.game_over = True 
    
    def update_texts(<span class="hljs-keyword">self</span>):            
        background(<span class="hljs-number">25</span>)
        noStroke()
        <span class="hljs-meta"># Set fill color to white</span>
        fill(<span class="hljs-number">255</span>)
        <span class="hljs-meta"># Display score</span>
        textSize(<span class="hljs-number">16</span>)
        textAlign(RIGHT)
        text(<span class="hljs-string">"Score"</span>, <span class="hljs-number">80</span>, HEIGHT - <span class="hljs-number">6</span>)
        textAlign(LEFT)
        text(<span class="hljs-keyword">self</span>.score, <span class="hljs-number">90</span>, HEIGHT - <span class="hljs-number">6</span>)
        <span class="hljs-meta"># text(<span class="hljs-meta-string">"Frames: %.1f"</span> %frameRate(), 130, HEIGHT - 6) </span>
        <span class="hljs-meta"># Display level</span>
        textAlign(RIGHT)
        text(<span class="hljs-string">"Level"</span>, WIDTH - <span class="hljs-number">50</span>, HEIGHT - <span class="hljs-number">6</span>)
        textAlign(LEFT)
        text(<span class="hljs-keyword">self</span>.level, WIDTH - <span class="hljs-number">40</span>, HEIGHT - <span class="hljs-number">6</span>)

    def update_blocks(<span class="hljs-keyword">self</span>):
        <span class="hljs-keyword">self</span>.blocks_gone = True
        <span class="hljs-meta"># Loop through all the potential blocks</span>
        collide = False

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(B_ROWS * B_COLS):
            <span class="hljs-meta"># Check if we have that block</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.blocks[i]):
                x_cent, y_cent = <span class="hljs-keyword">self</span>.centers[i]
                <span class="hljs-keyword">self</span>.blocks_gone = False
                    
                <span class="hljs-keyword">if</span> not collide:
                    bx, by = <span class="hljs-keyword">self</span>.ball.pos.x, <span class="hljs-keyword">self</span>.ball.pos.y     
                    <span class="hljs-meta"># check bounce on top/bottom</span>
                    <span class="hljs-keyword">if</span> ((x_cent - dw - r &lt; bx &lt; x_cent + dw + r) and 
                        ((y_cent + dh &lt; by &lt; y_cent + dh + r) or 
                        (y_cent -dh - r &lt; by &lt; y_cent - dh))):
                        <span class="hljs-keyword">self</span>.blocks[i] = <span class="hljs-number">0</span>
                        <span class="hljs-keyword">self</span>.ball.vel.y = -<span class="hljs-keyword">self</span>.ball.vel.y
                        <span class="hljs-keyword">self</span>.score = <span class="hljs-keyword">self</span>.score + <span class="hljs-number">5</span>
                        collide = True
                     
                    <span class="hljs-meta"># check bounce on left/right</span>
                    <span class="hljs-keyword">if</span> ((y_cent - dh - r &lt; by &lt; y_cent + dh + r) and 
                        ((x_cent + dw &lt; bx &lt; x_cent + dw + r) or 
                        (x_cent - dw -r &lt; bx &lt; x_cent - dw))):
                        <span class="hljs-keyword">self</span>.blocks[i] = <span class="hljs-number">0</span>
                        <span class="hljs-keyword">self</span>.ball.vel.x = -<span class="hljs-keyword">self</span>.ball.vel.x
                        <span class="hljs-keyword">self</span>.score = <span class="hljs-keyword">self</span>.score + <span class="hljs-number">5</span>
                        collide = True
            <span class="hljs-keyword">if</span> collide:
                <span class="hljs-keyword">break</span>
                    
    def draw_blocks(<span class="hljs-keyword">self</span>):
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(B_ROWS * B_COLS):
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.blocks[i]):
                fill(cell_colors[<span class="hljs-keyword">self</span>.blocks[i]])
                x_cent, y_cent = <span class="hljs-keyword">self</span>.centers[i]
                rect(x_cent, y_cent, <span class="hljs-number">2</span> * dw, <span class="hljs-number">2</span> * dh)
                        
    def update(<span class="hljs-keyword">self</span>):
        <span class="hljs-keyword">self</span>.update_texts()
        <span class="hljs-keyword">self</span>.update_ball()
        <span class="hljs-keyword">self</span>.update_paddle()
        <span class="hljs-keyword">self</span>.update_blocks()    
        <span class="hljs-keyword">self</span>.draw_blocks()
        
                  </code></pre>
        </div>

    </div>
  </body>
</html>